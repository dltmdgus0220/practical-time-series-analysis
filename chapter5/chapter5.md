5장 시간 데이터 저장
=

시계열 데이터의 가치는 과거에 축적된 데이터에서 자주 발생한다. 따라서 대부분의 시계열 분석에서는 시계열 데이터를 저장하기 위한 스토리지가 반드시 필요!!

요구 사항 정의
--

* 얼마나 많은 시계열 데이터를 저장해야하는가, 얼마나 데이터가 빠르게 증가하는가
* 측정에 대한 업데이트가 끊임없이 발생하거나, 측정이 구분되는 개별 사건 단위로 발생하는가
  
  
  전자는 가장 최근의 데이터를, 후자는 별개의 사건에 따라 분리된 개별 시계열 집합으로 구성된 데이터를 주로 관찰
* 데이터의 간격이 일정한가
* 지속적으로 데이터를 수집할 것인가, 아니면 마무리 시점이 정해져있는가
* 시계열로 하려는 것이 무엇인가, 실시간으로 시각화가 필요한가, 신경망이 수천 번 반복적으로 접근할 전처리된 데이터가 필요한가

실시간 데이터와 저장된 데이터
--
적합한 스토리지를 고를 때는 데이터의 생명주기를 이해하는 것이 가장 중요


지나치게 축적된 데이터를 유지하는 것보다 유의미한 시간 척도를 기준으로 저장된 데이터를 취합하는 것이 훨씬 더 유익

* 천천히 변하는 변수

  상태 변수를 저장한다면 값이 변한 데이터만 기록
* 노이즈가 낀 높은 빈도의 데이터

  높은 수준의 노이즈는 각 개별 측정의 가치를 떨어뜨리기 때문에 사전에 데이터의 종합 집계를 고려해야함. 
  
  그러나 도메인, 목적에 따라 노이즈의 평가가 필요한 경우도 있음
* 오래된 데이터

  매우 일반적인 경우를 제외하면 오래된 데이터일수록 활용 가능성은 줄어듬
  
데이터베이스 솔루션
---
관계형 데이터베이스는 시계열 데이터를 위한 좋은 옵션이다. 특히 다음 특성을 가진 특별한 솔루션이 필요할 때 더욱 효과가 좋다.
* 여러 서버로 확장 가능한 스토리지
* 저지연의 읽기/쓰기
* 일반적인 지표의 내장된 계산 함수(group-by 질의를 활용한 연산)
* 시스템의 성능 튜닝 및 병목 문제 분석에 사용되는 문제 진단 및 모니터링 도구

SQL가 NoSQL
---
관계형 테이블로 묘사될 수 없는 데이터는 적기 때문에 SQL이 최선책이라고 하지만 대용량 시계열 데이터에서는 성능 저하가 흔히 발생한다. 때문에 NoSQL 솔루션도 고려해볼 만한 가치가 있다.

시계열 데이터의 특성
---
시계열 데이터는 업데이트되지 않는 것이 일반적이며 데이터를 임의의 순서로 쓸 수 있는 작업은 중요하지 않다. 다시말해 SQL 데이터베이스의 설계가 초점을 맞춘 성능적 목표가 시계열 데이터베이스와는 잘 맞지 않다는 것이다.
* 읽기 작업보다 쓰기 작업이 지배적
* 데이터의 쓰기, 읽기, 업데이트 작업은 임의의 순서가 아닌 일련의 사건이 일어나는 시간에 관련된 순서에 따라 이루어짐
* 트랜잭션 데이터보다 훨씬 더 동시성 읽기가 수행될 가능성이 높음
* 시간 외의 변수를 기본키로 두는 경우는 매우 드뭄
* 개별 데이터 삭제보다 데이터 뭉치를 삭제하는 것이 훨씬 더 일반적

따라서 NoSQL 데이터베이스가 더욱 적합하다.

어떤 데이터 스토리지를 활용하던 같은 시간에 요청되는 경향이 있는 데이터는 같은 위치에 저장되어야만 한다는 것이 가장 중요하다.

시계열에 대해 SQL의 장점
---
* 시계열이 SQL 데이터베이스에 저장된다면, 해당 데이터베이스에 이미 저장된 관련성을 가진 다른 비시계열 데이터와 손쉽게 연관시킬 수 있음
* 계층적인 시계열 데이터에는 관계형 테이블이 잘 들어맞음
* 트랙잭션 데이터에 기반하여 시계열을 만든다면 SQL 데이터베이스의 이점을 누릴 수 있음

시계열에 대해 NoSQL의 장점
---
* 쓰기 속도가 빠름
* 미래 데이터를 충분히 알지 못해 견고한 스키마 설계가 불가능한 경우 유리함
* 비전문가가 사용하더라도 어느 정도 성능은 보장됨

시계열에 특화된 데이터베이스 및 관련된 모니터링 도구
---
* 인플럭스 DB

  시계열에 특화된 데이터베이스. 
  
  오픈 소스 시계열 데이터베이스로 평가 지표, 사건의 기록과 성능 분석에 유용. 
  
  푸시기반 데이터베이스 시스템.
  
  데이터를 시계열로 관리하는 인플럭스DB에서 하나의 데이터는 다음과 같이 구성됨
  * 타임스탬프
  * 측정 내용을 나타내는 라벨
  * 하나 이상의 키/값 필드
  * 키/값의 쌍으로 구성된 메타데이터 태그 정보

  시간을 인식하는 인플럭스DB는 모든 입력 데이터에 대한 타임스탬프를 자동으로 찍음.
  
  장점
  * 오래된 데이터의 지정 및 삭제 작업을 쉽게 자동화할 수 있는 데이터 보존 기능
  * 데이터의 빠른 수집 속도 및 적극적인 데이터 압축 기능
  * 시계열을 특정 기준으로 빠르게 색인하기 위해 각 시계열에 태그를 달 수 있는 기능
  * 시계열 데이터의 수집, 저장, 모니터링, 출력 모두를 포함하는 성숙된 TICK 스택의 한 부분을 차지하여 해당 스택과 쉬운 조화가 가능

* 프로메테우스
  HTTP 기반으로 동작하는 모니터링 시스템이자 시계열 데이터베이스. 
  
  모니터링과 스토리지를 강조하며 풀기반 시스템으로 시계열 생성을 위한 데이터 수집 방법 및 중앙 서버에 저장되는 데이터의 빈도에 대한 로직을 쉽게 조정하고 검사할 수 있다는 장점을 가짐. 
  
  질의에 PromQL이라는 함수 표현 언어 사용.
  
범용 NoSQL 데이터베이스
---
테이블 구조가 아닌 문서 구조에 기반. 

애플리케이션의 변화를 유연하게 수용 가능한 스키마와 질의가 필요하다면, 시간에 특화된 유연성과 일반적인 유연성의 균형을 고루 갖춘 범용 NoSQL 데이터베이스가 적합.

앞서 말한 데이터베이스들을 사용할 때의 장점
* 빠른 읽기 또는 쓰기 능력(또는 둘 다)
* 유연한 데이터 구조
* 푸시 또는 풀기반 데이터 수집
* 자동화된 데이터 제거 기능

파일 솔루션
---
데이터베이스는 스크립트와 데이터 스토리지를 모두 통합하는 작업을 수행하는 소프트웨어.

그 통합된 결과는 단층 파일. 해당 파일에 안전하고 쉽게 접근할 수 있도록 데이터베이스가 래핑.

단층 파일 솔루션을 선택하는 경우
* 성숙된 데이터 형식이 완성되어 오랜 기간 동안 합리적으로 그 명세를 따를 수 있는 경우
* 데이터 처리가 I/O와 밀접한 관련되어 있어서 그 속도의 향상에 개발 시간을 할애하는 것이 합리적인 경우
* 데이터의 무작위적인 접근보다 순차적인 접근이 필요한 경우

단층 파일로 마이그레이션하는 번거로움을 감수하더라도 이를 구현해볼 만한 이점
* 단층 파일은 특정 시스템에 종속적이지 않음
* 단층 파일이 데이터베이스보다 I/O 작업이 훨씬 간결하기에 오버헤드가 낮음.
* 단층 파일에서는 데이터의 읽히는 순서를 표현 가능
* 데이터를 가능한 한 최대로 압축 가능


* 넘파이 : 데이터가 순수 수치형으로만 구성되어 있을 경우 좋음. 그러나 단일 데이터 형식만 존재한다는 단점을 가짐   
* 팬더스 : 손쉬운 데이터의 레이블링, 서로 다른 시계열 데이터의 저장에 이점을 가짐
* 표준 R에 동등한 것 : 이진 파일 형식으로 저장되기 때문에 압축과 I/O 측면에서 더욱 효율적
* Xarray
  * 차원에 명명할 수 있는 기능 제공
  * 넘파이같이 벡터화된 수학적 연산 제공
  * 팬더스같이 그룹화 연산 제공
  * 데이터베이스같이 시간 범위 기반의 색인 기능 제공
  * 다양한 파일 스토리지 옵션 
